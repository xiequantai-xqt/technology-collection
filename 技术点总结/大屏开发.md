# 高德地图

## 效果图以及代码

地图效果图：

![](https://super-note.oss-cn-shenzhen.aliyuncs.com/%E5%89%8D%E7%AB%AF/Snipaste_2024-05-30_15-48-38.png)

整体代码：

```vue
<template>
  <div id="mapEcharts" style="width: 100%;height: 600px;"></div>
</template>

<script>
  export default {
    name: 'MapView',
    mounted() {
      this.draw();
    },
    methods:{
      draw(){
        // 初始化地图
        var map = new AMap.Map('mapEcharts', {
            zoom: 8, // 初始地图级别
            center: [116.39,39.9], // 地图中心点坐标
        });

        // 示例点数据
        var points = [
            [116.41,40.92],
            [116.42,39.91],
        ];

        // 定义一个全局变量来保存当前打开的信息窗口，以便在鼠标移出时关闭
        let currentInfoWindow = null;
        // 在地图上添加散点并绑定事件
        points.forEach((point,index) => {
          const marker = new AMap.Marker({
            position: point,
          });
          marker.setMap(map);
          // 绑定mouseover事件
          AMap.Event.addListener(marker, 'mouseover', () => {
            // 如果之前有打开的信息窗口，先关闭它
            if (currentInfoWindow) {
              currentInfoWindow.close();
            }
            
            // 创建新的信息窗口
            const infoWindow = new AMap.InfoWindow({
              content: `<div style="background-color: white;">这是第${index + 1}个点的详细信息</div><br>454`,
              offset: new AMap.Pixel(0, -30), // 设置信息窗口偏移量
            });
            
            // 打开信息窗口
            infoWindow.open(map, marker.getPosition());
            currentInfoWindow = infoWindow; // 更新当前信息窗口引用
          });

          // 绑定mouseout事件以关闭信息窗口
          AMap.Event.addListener(marker, 'mouseout', () => {
            if (currentInfoWindow) {
              currentInfoWindow.close();
              currentInfoWindow = null;
            }
          });
        });
    }
  }
}
</script>

<style scoped>
</style>
```

## 注意

### 监听事件的写法

- 如果是引入了高德地图的2.0版本，Event是大写，`AMap.Event.addListener`

- 如果是引入了高德地图的1.4版本，event是小写，`AMap.event.addListener`

### 地图样式

与百度地图不同，高德地图是在控制台配置上去的，发布完自定义地图，在代码里定义一个id，样式自动更新。



**第一步，配置地图**

配置地图的步骤：

1. 访问高德地图开放平台的官网：https://lbs.amap.com/
2. 登录你的高德地图账号。
3. 在顶部导航栏中找到“开发工具”或“开发者工具”，通常在页面的右上角。
4. 在“开发工具”下拉菜单中选择“自定义地图样式”或类似的选项。
5. 这里你应该能看到地图样式编辑器，可以创建、编辑和管理你的自定义地图样式。

> 如果你仍然找不到入口，建议直接在高德地图开放平台的首页搜索“自定义地图样式”或查看官方文档，以获取最新的接入指南。同时，确保你拥有有效的高德地图开发者账号，因为一些高级功能可能需要付费或申请权限。



**第二步，引入安全密钥**

```html
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title><%= htmlWebpackPlugin.options.title %></title>
  </head>
  <body>
    <div id="app"></div>
    <!-- 安全密钥 -->
    <script>
      window._AMapSecurityConfig = {
        securityJsCode: 'aa6d5d2d1b665c87f77869e3d9371ce8'
      };
    </script>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=ab0cf27461eccdad490ccc839563c368"></script>
  </body>
</html>
```

# 订单自动滚动

![](https://super-note.oss-cn-shenzhen.aliyuncs.com/%E5%89%8D%E7%AB%AF/Snipaste_2024-05-30_15-33-44.png)

刚进入页面时执行一次：

```javascript
_initMethod: function () {
      // 订单
      vc.component.fetchOrderList()
}
```

每隔3分钟刷新一次订单：

```javascript
_initEvent:function(){
    // 3分钟刷新一次订单
  setInterval(() => {
    vc.component.fetchOrderList()
  }, 180000);
}
```

定义fetchOrderList函数（获取订单数据）：

```javascript
// 获取订单数据
  fetchOrderList(){
    vc.http.apiPost(
      "/chargingInvoiceInfo.chargingScreenOrderListCmd",
      JSON.stringify({
        memberId:vc.getData("/nav/getUserInfo").memberId,
        "page": 1, 
        "row": 9999
      }),
      {
        emulateJSON: true,
      },
      function (json, res) {
        var resData = JSON.parse(json);
        if(resData.code === 0){
          // console.log(Math.ceil(resData.data.length/3));
          $that.screenOrderList = []

          $that.screenOrderList = resData.data.map(item=>({
            ...item,
            address: item.address?item.address.slice(0,10):''
          }))
          let INTERVAL_ORDER = setInterval(() => {
            requestAnimationFrame(function(){
              vc.component.autoScroll()
            })
          }, 1000);
          setTimeout(() => {
            clearInterval(INTERVAL_ORDER)
          }, 180000);
        }
      },
      function (errInfo, error) {
      }
    );
  }
```

自动滚动功能：

```javascript
autoScroll() {
    var ordersContainer = document.getElementsByClassName('orderContainer')[0];
    // 获取当前滚动位置
    var currentScrollTop = ordersContainer.scrollTop;
    // 计算下一个滚动位置，这里简单地向下滚动10像素，可以根据需要调整
    var nextScrollTop = currentScrollTop + 8;
    
    // 如果没有滚动到底部，则继续滚动
    if (nextScrollTop < ordersContainer.scrollHeight - ordersContainer.offsetHeight) {
        ordersContainer.scrollTop = nextScrollTop;
        // 使用setTimeout设置下一次滚动，这里设置为100毫秒，根据需要调整速度
        // setTimeout(() => {
        //   requestAnimationFrame(function(){
        //     vc.component.autoScroll()
        //   })
        // }, 30000);
    } else {
        // 如果滚动到了底部，可以选择回到顶部重新开始，或者停止滚动
        ordersContainer.scrollTop = 0; // 回到顶部
        // 重新启动滚动
        // setTimeout(() => {
        //   requestAnimationFrame(function(){
        //     vc.component.autoScroll()
        //   })
        // }, 30000);
    }
 }
```

