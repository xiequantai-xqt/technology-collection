> 使用的插件是tinymce

![](https://super-note.oss-cn-shenzhen.aliyuncs.com/%E5%89%8D%E7%AB%AF/%E5%AF%8C%E6%96%87%E6%9C%AC%E9%A2%84%E8%A7%88.png)

# 安装依赖

```shell
npm install --save "@tinymce/tinymce-vue@^5"
```

# 页面

> addPlatform.vue

模板部分：

```html
<template>
    <Editor
      :api-key="apiKey"
      :init="initConfig"
       v-model="editeContent"
     />
</template>
```

逻辑部分：

```typescript
import Editor from '@tinymce/tinymce-vue'
const apiKey = ref('lg9kxl5afdfwpfcrogrv5ewn9vdhm6q4vwhu6d1qyiebrhn5')
const initConfig = ref({
  menubar: false, // 不显示任何菜单栏
  language: 'zh_CN',
  plugins: 'anchor autolink hr charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist mediaembed casechange export formatpainter pageembed linkchecker a11ychecker tinymcespellchecker permanentpen powerpaste advtable advcode editimage advtemplate mentions tableofcontents footnotes mergetags autocorrect typography inlinecss markdown fullscreen',
  toolbar: [
    'blocks blockquote | bold underline italic forecolor backcolor | fontsize fontfamily lineheight | bullist numlist checklist | alignleft',
    'alignright | emoticons link image | table codesample hr | undo redo | fullscreen '
  ],
  // 设置行高
  line_height_formats: '1 1.2 1.4 1.6 2'
})
const editeContent = ref('')
```

# 图片上传

> addPlatform.vue

```typescript
const apiKey = ref('lg9kxl5afdfwpfcrogrv5ewn9vdhm6q4vwhu6d1qyiebrhn5')
const initConfig = ref({
  menubar: false, // 不显示任何菜单栏
  language: 'zh_CN',
  plugins: 'anchor autolink hr charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount linkchecker fullscreen',
  toolbar: [
    'blocks blockquote | bold underline italic forecolor backcolor | fontsize fontfamily lineheight | bullist numlist | alignleft',
    'alignright | emoticons link image | table codesample hr | undo redo | fullscreen '
  ],
  line_height_formats: '1 1.2 1.4 1.6 2',
  images_file_types: 'jpeg,png,jpg,svg,webp',
  file_picker_types: 'image',
  automatic_uploads: true,
  // 用于自定义处理文件选择和上传的逻辑
  file_picker_callback: (cb) => {
    const input = document.createElement('input');
    input.setAttribute('type', 'file');
    input.setAttribute('accept', 'image/*');

    input.addEventListener('change', (e) => {
      let file
      const fileInput = e.target as HTMLInputElement;
      if (fileInput.files && fileInput.files.length > 0) {
            file = fileInput.files[0];
        } else {
          // 处理没有文件或文件列表为空的情况
          console.error('选择的不是文件');
        }

      const reader = new FileReader();
      reader.addEventListener('load', () => {
        /*
          Note: Now we need to register the blob in TinyMCEs image blob
          registry. In the next release this part hopefully won't be
          necessary, as we are looking to handle it internally.
        */
        const id = 'blobid' + (new Date()).getTime();
        
        const blobCache =  tinymce.activeEditor.editorUpload.blobCache;
        const base64 = (reader.result as string)?.split(',')[1];
        const blobInfo = blobCache.create(id, file, base64);
        blobCache.add(blobInfo);

        /* call the callback and populate the Title field with the file name */
        cb(blobInfo.blobUri(), { title: file.name });
      });
      reader.readAsDataURL(file);
    });

    input.click();
  }
})
```

# ts报错

![](https://guiwanzhyq.oss-cn-hangzhou.aliyuncs.com/hc/img/20240813/311277ad-c58a-40a3-ba81-fa39930804bb.png)

问题原因：由于tinymce变量是被npm挂载到window下面的，所以ts找不到。

解决方法：在项目的 src 目录下创建一个 typings.d.ts 文件

> typings.d.ts

```typescript
// global.d.ts 或 typings.d.ts
declare var tinymce: any; // 或者更具体的类型定义
```

# 域名问题

这个组件如果访问需要配合域名的，否则无法访问。

> 添加域名：https://www.tiny.cloud/my-account/domains

![](https://guiwanzhyq.oss-cn-hangzhou.aliyuncs.com/hc/img/20240813/1ab48d42-6d0c-4a34-9c58-7dc171f20d58.png)