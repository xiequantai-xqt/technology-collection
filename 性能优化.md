性能优化分为三个角度“页面渲染”、“打包优化”、“总体优化”。

# 页面渲染

## 减少页面的重绘和回流

> 回流：计算可见节点的位置和几何信息;
> 重绘：重新绘制节点，将渲染树的每个节点都转换为屏幕上的实际像素；

- 复杂的动画元素定位要设置为 fixed 或 absoult，避免引起回流；
- 不使用table布局（table元素一旦触发回流就会导致table里所有的其它元素回流）；
- DOM 元素上下移动用用translate替代top修改；
- 在大量修改元素样式时，可以先用display： none将其隐藏，修改完再设置为display： block，这样只会造成两次回流；

## 图片懒加载

传统的图片加载方式是在页面加载完成后一次性加载所有图片资源，这样会造成页面加载时间过长，带宽消耗过大，影响用户体验。

当图片出现在浏览器的可视区域内时，才加载图片让图片显示出来（在此之前可以将所有图片元素的路径全都统一设置成一张1*1px的占位图）。

判断图片出现在浏览器可视区域的方法：图片距离顶部的高度（offsetTop） - 页面被卷去的高度（scrollTop） <= 浏览器的可视区域的高度（innerHeight）。

### 懒加载的优点

1. 减少首页加载的时间：初始页面只加载必要内容，而不需要等待所有资源都加载完成。
2. 提高用户体验：页面每次加载都只是加载一部分资源，加载更快，用户可以更快地交互和浏览内容。
3. 节约带宽消耗：只加载用户需要的内容，减少不必要的带宽消耗。

### 懒加载如何实现

实现核心有两部分：

1. 判断图片是否已经进入可视区域范围
2. 图片进入可视区域后，触发加载图片



## 预加载

资源预加载包括预连接、资源预渲染等。预加载的思路有两个：

1. 当前将要获取资源的列表；
2. 通过当前页面或者应用状态、用户历史或者session预测用户行为，以及必须的资源；

# 打包优化

## 1.webpack优化resolve.alias配置（vite同理）

`resolve.alias` 配置通过别名来将原导入路径映射成一个新的导入路径。
可以起到两个作用：1.起别名；2.减少查找过程。

例如：

```javascript
resolve: {
    alias: {
      'vue$': 'vue/dist/vue.esm.js',
      '@': resolve('src'),
    }
  }
```

## 2.webpack优化resolve.extensions配置（vite同理）

`resolve.extensions` 代表后缀尝试列表，它也会影响构建的性能，默认是：`extensions: ['.js', '.json']`。

后缀尝试列表要尽可能的小，不要把项目中不可能存在的情况写到后缀尝试列表中，频率出现最高的文件后缀要优先放在最前面，以做到尽快的退出寻找过程。

```json
resolve: {
    extensions: ['.js', '.vue', '.json'],
}
```

## 3.webpack缩小loader范围

loader是很消耗性能的一个点，我们在配置loader的时候，可以使用include和except来缩小loader执行范围，从而优化性能。 例如：

```javascript
{
    test: /\.svg$/,
    loader: 'svg-sprite-loader',
    include: [resolve('src/icons')]
 }
```

## 4.tree shaking

用来清除我们项目中的一些无用代码，它依赖于ES中的模块语法得以实现。`tree shaking`可以大大减少包体积，是性能优化中的重要一环。 在 vite 和 webpack4.x 中都已经默认开启tree-shaking。

## 5.vite关闭一些打包配置项

```json
build: { 
      terserOptions: {
        compress: {
          //生产环境时移除console
          drop_console: true,
          drop_debugger: true,
        },
      },
      //关闭文件计算
      reportCompressedSize: false,
      //关闭生成map文件 可以达到缩小打包体积
      sourcemap: false, // 这个生产环境一定要关闭，不然打包的产物会很大
}
```

# 总体优化

## 1.SSR服务端渲染

它指的是渲染过程在服务端完成，最终的渲染结果 HTML 页面通过 HTTP 协议发送给客户端，又叫“同构“。

SSR主要带来的好处就是 SEO 和首屏加载速度大大提高。

## 2.开启gzip压缩

gzip对文件压缩能大大提高首屏加载速度，对于纯文本文件我们可以至少压缩到原大小的40%，图片不要开启gzip压缩，因为压缩效果不明显。

## 3.组件按需加载

引入第三方组件库，按需加载

## 4.组件异步加载

```javascript
// 1. import懒加载
() => import('@/pages/xxx.vue')
// 2. 使用require
resolve => require(['@/pages/xxx.vue'], resolve)
```

## 5.CDN内容分发

静态文件，音频，视频，js资源，图片等都可以放CDN上。原理是，将资源放在遍布世界各地的服务器上，访问资源的时候，请求会重定向到 离用户最近的服务节点上。

